# 受注管理システム

Blazor Serverの受注管理システムをNext.jsに移植したアプリケーションです。

## 機能

- ユーザー認証・セッション管理
- ユーザー権限（ロール）によるメニュー制御
- 受注の一覧・検索・登録・更新・削除
- 得意先・商品のサジェスト機能
- 楽観的排他制御
- 複合的なバリデーション
- ヘッダー・明細の1:N構造

## 技術スタック

- Next.js 16 (App Router)
- TypeScript
- SQLite (better-sqlite3)
- NextAuth.js v5 (認証)
- React Hook Form + Zod (フォーム管理・バリデーション)
- Tailwind CSS

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) を開きます。

### 3. ログイン

以下のテストユーザーでログインできます：

- **管理者**: ユーザー名 `admin` / パスワード `admin123`
- **一般ユーザー**: ユーザー名 `user` / パスワード `user123`

## データベース

SQLiteデータベース（`orderapp.db`）がプロジェクトルートに自動的に作成されます。

初期データとして以下が投入されます：
- 2つのユーザー（admin, user）
- 3つのサンプル得意先
- 5つのサンプル商品

## プロジェクト構造

```
src/
├── app/
│   ├── (protected)/          # 認証が必要なページ
│   │   ├── orders/            # 受注管理
│   │   ├── customers/          # 得意先マスタ（管理者のみ）
│   │   └── products/          # 商品マスタ（管理者のみ）
│   ├── api/                   # APIルート
│   ├── login/                 # ログインページ
│   └── layout.tsx
├── components/
│   ├── Layout.tsx             # レイアウトコンポーネント
│   ├── AuthGuard.tsx          # 認証ガード
│   └── SuggestTextBox.tsx     # サジェストコンポーネント
├── lib/
│   ├── db.ts                  # データベース初期化
│   ├── auth.ts                # 認証設定
│   └── repositories/          # リポジトリパターン
└── types/
    └── index.ts               # TypeScript型定義
```

## 主な機能の説明

### サジェスト機能

- **得意先サジェスト**: 全件をメモリに保持し、フォーカス時に即座に表示
- **商品サジェスト**: キーワード入力時にAPI経由で検索（デバウンス処理付き）

### 楽観的排他制御

受注の更新時にバージョン番号をチェックし、他のユーザーによる更新を検出します。

### 権限管理

- 管理者（Administrator）: すべての機能にアクセス可能
- 一般ユーザー（User）: 受注管理のみアクセス可能

## ライセンス

MIT
